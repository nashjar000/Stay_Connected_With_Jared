<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipes - Stay Connected With Jared</title>
    <link rel="icon" type="image/x-icon" href="images/mylogo.png">
    <script src="./js/themes/themeManager.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./js/config.js"></script>
    <script src="./js/supabaseClient.js"></script>
    <link rel="stylesheet" href="./styles/recipie.css">
    <script defer src="./js/components/header.js"></script>
    <script defer src="js/components/footer.js"></script>
    <link rel="stylesheet" href="./styles/scroll-button.css">
    <link rel="stylesheet" href="./styles/user-status.css">
    <script defer src="./js/scroll-button.js"></script>
    <script defer src="./js/components/user-status.js"></script>
</head>
<script defer src="./js/components/mobile-menu.js"></script>

<body>
    <div id="content">
        <div id="header"></div>
        <!-- <button onclick="darklightmode()">Dark/Light</button>
        <script>
            function darklightmode(){
                var element = document.body;
                element.classList.toggle("dark-mode");
            }
        </script> -->
        <main class="Home-grid">
            <section id="recipies-msg">
                <h1 class="recipies-title" id="recipie-links">Recipes</h1>
                <p>These are some of my favorite recipes for foods I like to make.</p>

                <section class="recipie-links">
                    <a href="#cinnamon-roll" id="recipie-link">Microwaveable Cinnamon-Roll</a>
                    <a href="#syrup" id="recipie-link">Homemade Syrup</a>
                    <a href="#butterbeer" id="recipie-link">Butterbeer (warm)</a>
                    <a href="#reeses" id="recipie-link">Reese's Peanut-butter Cup</a>
                    <a href="#celestial-cookie" id="recipie-link">Celestial Cookie (Family)</a>
                </section>

                <section class="celestial-cookie-section" id="celestial-cookie">
                    <h2 class="cinnamon-roll">Celestial Cookie (Family Recipe)</h2>
                    <a href="#recipie-links" id="top-rec">Back to top</a>

                    <div id="celestial-cookie-locked" class="celestial-cookie-locked">
                        <p>This recipe is family-only.</p>
                        <p>Please log in with an approved account to view it.</p>
                        <div class="auth-actions">
                            <a href="./auth-login.html?redirect=./recipies.html" class="auth-action-button">Log In</a>
                            <a href="./auth-signup.html" class="auth-action-button secondary">Sign Up</a>
                        </div>
                    </div>

                    <div id="celestial-cookie-protected" style="display: none;">
                        <h3 class="ingred-title">Ingredients</h3>
                        <p class="ingredients">2 1/4 cups flour</p>
                        <p class="ingredients">1 cup softened butter</p>
                        <p class="ingredients">3/4 cup brown sugar</p>
                        <p class="ingredients">1/2 cup sugar</p>
                        <p class="ingredients">1 egg + 1 yolk</p>
                        <p class="ingredients">1 tsp vanilla</p>
                        <p class="ingredients">1 tsp baking soda</p>
                        <p class="ingredients">1/2 tsp salt</p>
                        <p class="ingredients">1 cup white chocolate chips</p>
                        <p class="ingredients">1/2 cup toffee bits</p>

                        <h3 class="directions-title">Directions</h3>
                        <p class="directions">This is a placeholder “family-only” version for now. Cream butter + sugars, mix in egg and vanilla, then fold in dry ingredients. Stir in chips and toffee bits, chill dough 20 minutes, scoop, and bake at 350°F for 10-12 minutes until edges are lightly golden. Let cool and enjoy warm.</p>
                    </div>
                </section>

                <h2 class="cinnamon-roll" id="cinnamon-roll">Microwaveable Cinnamon Roll (makes one)</h2>
                <a href="#recipie-links" id="top-rec">Back to top</a>

                <h3 class="ingred-title">Ingredients</h3>
                <p class="cinnamon">Cinnamon Roll</p>
                <p class="ingredients">1 Tbsp butter, salted melted</p>
                <p class="ingredients">1/2 cup flour</p>
                <p class="ingredients">1 Tbsp sugar</p>
                <p class="ingredients">pinch of salt</p>
                <p class="ingredients">2 Tbsp milk</p>

                <p class="cinnamon">Cinnamon Filling</p>
                <p class="ingredients">1 tsp butter</p>
                <p class="ingredients">1 Tbsp brown sugar</p>
                <p class="ingredients">1/2 tsp cinnamon</p>

                <p class="cinnamon">Glaze</p>
                <p class="ingredients">1/4 cup powdered sugar</p>
                <p class="ingredients">1/2 Tbsp milk</p>
                <p class="ingredients">1/8-1/4 tsp vanilla</p>

                <h3 class="directions-title">Directions</h3>
                <p class="directions">In a bowl, combine 1 Tbsp melted butter, flour, baking powder, sugar, slat and
                    milk.
                    Dough will be shaggy. Bring it together with your hands. Roll out on a lightly floured surface into
                    a 6 x 9 inch rectangle.</p>
                <p class="directions">In a small bowl combine 1 Tbsp butter, brown sugar and cinnamon. Spread over
                    dough.
                    Cut dough into three strips with a knife or pizza cutter. Roll up middle strip. Match of cut edges
                    and roll up other two strips into one cinnamon roll. Place in a greased 6 oz. ramekin (or mug)</p>
                <p class="directions">Combine powdered sugar, milk and vanilla for glaze.</p>
                <p class="directions">Cook in microwave for 90 seconds. If it seems under cooked, cook for 10 more
                    additional seconds.</p>
                <p class="directions">Drizzle roll with glaze and enjoy warm.</p>

                <h2 class="syrup" id="syrup">Homemade Syrup</h2>
                <a href="#recipie-links" id="top-rec">Back to top</a>

                <h3 class="ingred-title">Ingredients</h3>
                <p class="ingredients">1 cube of butter (1/2 cup)</p>
                <p class="ingredients">1 cup sugar</p>
                <p class="ingredients">1/2 cup of milk with 1 tablespoon of lemon juice, lime juice OR vinegar mixed
                    with milk before adding to the saucepan with the other ingredients.</p>
                <p class="ingredients">1 teaspoon dark Karo syrup</p>
                <p class="ingredients">1/2 teaspoon baking soda</p>
                <p class="ingredients">1/2 teaspoon water</p>
                <p class="ingredients">1 teaspoon vanilla</p>

                <h3 class="directions-title">Directions</h3>
                <p class="directions">Combine butter, sugar, milk with vinegar (or lemon or lime), and karo syrup into
                    sauce pan. Bring to a boil and boil for 1 minute. Don’t over boil. Remove from stove and add 1
                    teaspoon vanilla. </p>
                <p class="directions">Dissolve the baking soda in the water and add to the syrup. Stir and enjoy!</p>

                <h2 id="butterbeer">Butterbeer (warm)</h2>
                <a href="#recipie-links" id="top-rec">Back to top</a>

                <h3 class="ingred-title">Ingredients</h3>

                <p class="ingredients">2tbs Butter</p>
                <p class="ingredients">2tbs Brown sugar</p>
                <p class="ingredients">2 Cups Milk</p>
                <p class="ingredients">2tbs Butterscotch</p>
                <p class="ingredients">12oz (1 can) Cream Soda</p>

                <h3 class="directions-title">Directions</h3>
                <p class="directions">Melt butter, brown sugar, and milk in a pot, medium temperature, stirring
                    occasonally.
                    Once the butter is melted, add desired amount of butter scotch. Heat a little longer. Add the soda
                    and heat. Pour into
                    mug, let it cool a little, and drink. Top with whipped cream and butter scotch if desired.</p>

                <h2 id="reeses">Reese's Peanut-butter Cup</h3>
                    <a href="#recipie-links" id="top-rec">Back to top</a>


                    <h3 class="ingred-title">Ingredients</h3>
                    <p class="ingredients">1/2 Cup Peanut-butter</p>
                    <p class="ingredients">3Tbs powdered sugar</p>
                    <p class="ingredients">1 Cup chocolate chips</p>

                    <h3 class="directions-title">Directions</h3>
                    <p class="directions">Stir peanutbutter and powdered sugar together until combined. Melt chocolate
                        in a double boiler or in the microwave.
                        Line muffin tin with paper cupcake cups. Pour melted chocolate just covering the bottom of each
                        muffin cup. Drop a small ball of peanut butter
                        in each cup. Cover with the rest of the melted chocolate. Put in fridge for about an hour or
                        until chocolate hardens. Now, they are
                        ready to eat.
                    </p>
                    <button id="scrollToTopButton" class="scroll-to-top-button" onclick="scrollToTop()">
                        <i class="fas fa-arrow-up"></i>
                    </button>


            </section>
    </div>

    </main>

    </main>
    </div>
</body>

<script>
    async function checkCelestialCookieAccess() {
        const lockedSection = document.getElementById('celestial-cookie-locked');
        const protectedSection = document.getElementById('celestial-cookie-protected');

        if (!lockedSection || !protectedSection) {
            return;
        }

        try {
            if (!window.auth || !window.supabaseClient) {
                await new Promise((resolve) => {
                    const waitForAuth = () => {
                        if (window.auth && window.supabaseClient) {
                            resolve();
                        } else {
                            setTimeout(waitForAuth, 100);
                        }
                    };
                    waitForAuth();
                });
            }

            const user = await auth.getCurrentUser();
            if (!user) {
                lockedSection.style.display = 'block';
                protectedSection.style.display = 'none';
                return;
            }

            const isAdmin = await auth.isAdmin(user.id);
            let hasRecipeAccess = false;

            if (!isAdmin) {
                const { data, error } = await supabaseClient
                    .from('recipe_access_users')
                    .select('approved')
                    .eq('user_id', user.id)
                    .maybeSingle();

                if (error) {
                    if (String(error?.message || '').includes("Could not find the table 'public.recipe_access_users'")) {
                        console.warn('recipe_access_users table missing; run supabase/recipe_access_setup.sql');
                    } else {
                        throw error;
                    }
                }

                hasRecipeAccess = !!(data && data.approved === true);
            }

            const isApproved = isAdmin || hasRecipeAccess;

            if (isApproved) {
                lockedSection.style.display = 'none';
                protectedSection.style.display = 'block';
            } else {
                lockedSection.style.display = 'block';
                protectedSection.style.display = 'none';
            }
        } catch (error) {
            console.error('Error checking celestial cookie access:', error);
            lockedSection.style.display = 'block';
            protectedSection.style.display = 'none';
        }
    }

    window.addEventListener('load', checkCelestialCookieAccess);
</script>

</html>